<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <title>Signup</title>
</head>

<body onload="document.form1.fname.focus()">
    <form name="form1">
        <h2>Register</h2>
        <hr>
        <div class="row mb-3">
            <label for="fname" class="col-sm-2 col-form-label">Firstname</label>
            <div class="col-sm-10">
                <input type="text" class="form-control" id="fname" placeholder="ex.(John)" name="fname">
            </div>
        </div>
        <div class="row mb-3">
            <label for="lname" class="col-sm-2 col-form-label">Lastname</label>
            <div class="col-sm-10">
                <input type="text" class="form-control" id="lname" placeholder="ex.(Wick)" name="lname">
            </div>
        </div>
        <div class="row mb-3">
            <label for="uname" class="col-sm-2 col-form-label">Username</label>
            <div class="col-sm-10">
                <input type="text" class="form-control" id="uname" placeholder="ex.(JWick)" name="uname">
            </div>
        </div>
        <div class="row mb-3">
            <label for="email" class="col-sm-2 col-form-label">Email</label>
            <div class="col-sm-10">
                <input type="text" class="form-control" id="email" placeholder="ex.(john_wick@gmail.com)" name="email">
            </div>
        </div>
        <div class="row mb-3">
            <label for="password" class="col-sm-2 col-form-label">Password</label>
            <div class="col-sm-10">
                <input type="password" class="form-control" id="password" placeholder="Enter your Password"
                    name="password">
            </div>
        </div>
        <div class="row mb-3">
            <label for="cpassword" class="col-sm-2 col-form-label">Confirm Password</label>
            <div class="col-sm-10">
                <input type="password" class="form-control" id="cpassword" placeholder="Enter your Confirm Password"
                    name="cpassword">
            </div>
        </div>
        <div class="row mb-3">
            <label for="birthdate" class="col-sm-2 col-form-label">Birthdate</label>
            <div class="col-sm-10">
                <input type="date" class="form-control" id="birthdate" name="birthdate">
            </div>
        </div>
        <div class="row mb-3">
            <label for="contact" class="col-sm-2 col-form-label">Contact</label>
            <div class="col-sm-10">
                <input type="tel" class="form-control" id="contact" placeholder="Enter your Contact" name="contact"
                    maxlength="11">
            </div>
        </div>
        <button id="print" type="button" class="btn btn-primary">Register</button>
        <button id="search" type="button" class="btn btn-primary">Search</button>
        <div class=" signup_link">
            Already have an account? <a href="login.html">Login</a>
        </div>

        <div id="display"></div>
    </form>


    <!-- --------------------------------------------------------javascript---------------------------------------------- -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script type="text/javascript">

        //input ids
        var FirstName = document.getElementById("fname");
        var LastName = document.getElementById("lname");
        var UserName = document.getElementById("uname");
        var Email = document.getElementById("email");
        var Password = document.getElementById("password");
        var ConfirmPassword = document.getElementById("cpassword");
        var Birthdate = document.getElementById("birthdate");
        var Contact = document.getElementById("contact");


        var letters = /^[A-Za-z]+$/;//letters only

        var mailformat = /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/;//valid email

        var numbers = /^[0-9]+$/;//numbers only

        var mixed = /^[0-9a-zA-Z]+$/ //letters and numbers

        // var signup = null; //print users in div

        var userInput = new Array(); //array of user input


        document.getElementById("print").addEventListener("click", function () {
            showData();
        });
        function showData() {
            inputValidation();
        }

        //input validation
        function inputValidation() {

            if (FirstName.value == "") {
                alert("Firstname is empty.");
                return false;
            } else if (!FirstName.value.match(letters)) {
                alert("Firstname should be letters only.");
                return false;
            }
            if (LastName.value == "") {
                alert("Lastname is empty.");
                return false;
            } else if (!LastName.value.match(letters)) {
                alert("Lastname should be letters only.");
                return false;
            } else if (UserName.value.length < 4 || UserName.value.length > 10) {
                alert("Username must be 4 character to 10 characters long.");
                return false;
            } else if (userNameTaken(uname) !== false) {
                return UserName.value = "";
            }
            if (Email.value == "") {
                alert("Email is empty.");
                return false;
            } else if (!Email.value.match(mailformat)) {
                alert("Email is invalid.");
                return false;
            }
            if (Password.value == "") {
                alert("Password is empty.");
                return false;
            } else if (Password.value.length < 6 || Password.value.length > 12) {
                alert("Password must be 6 character to 12 characters long.");
                return false;
            }
            if (ConfirmPassword.value == "") {
                alert("Confirm Password is empty.");
                return false;
            } else if (Password.value != ConfirmPassword.value) {
                alert("Password does not match.");
                return false;
            }
            if (Birthdate.value == "") {
                alert("Birthdate is empty.");
                return false;
            }
            if (Contact.value == "") {
                alert("Contact is empty.");
                return false;
            } else if (!Contact.value.match(numbers)) {
                alert("Contact is invalid.");
                return false;
            }
            else {
                registerUser();
            }
        }

        //age function
        function getAge() {
            //get age using date
            var bday = new Date(Birthdate.value);
            if (Birthdate.value == null || Birthdate.value == '') {
                return false;
            } else {

                //milliseconds since jan 1, 1970 up to current date minus milliseconds from jan 1, 1970 to date given
                var monthDifference = Date.now() - bday.getTime();

                //converts the calculated difference in date format 
                var newDate = new Date(monthDifference);

                //get year from date
                var getYear = newDate.getUTCFullYear();

                //now calculate the absoltue value of age
                var Age = Math.abs(getYear - 1970);

                return Age;
            }
        }

        //save user array
        function saveUser() {

            //get current date and time
            var timeDate = new Date();

            //array of user data
            var userData = [FirstName.value, LastName.value, UserName.value, Email.value, Password.value, ConfirmPassword.value, getAge() + "yrs old", Birthdate.value, Contact.value, timeDate];

            userInput.push(userData);
            console.log(userInput);

            FirstName.value = "";
            LastName.value = "";
            UserName.value = "";
            Email.value = "";
            Password.value = "";
            ConfirmPassword.value = "";
            Birthdate.value = "";
            Contact.value = "";
            timeDate = "";
            document.getElementById("display").innerHTML = "";

            alert("Successfully Registered!");
            return userData;
        }

        //username alredy exists
        function userNameTaken(dataValue) {
            if (userInput === undefined) {
                return false;
            }

            var user = null;

            userInput.forEach(index => {
                if (dataValue.value === index[2])
                    user = index;
            });

            if (user !== null) {
                alert('Please choose another username.');
            } else {
                return false;
            }
        }

        //search fucntion
        function searchUser() {
            var output = null;
            var findData = document.getElementById("uname").value;

            for (let i = 0; i < userInput.length; i++) {
                if (userInput[i][2] === findData) {
                    output = userInput[i];
                    // console.log(output);
                    // document.getElementById("display").innerHTML = output;
                    break;
                }
            }

            return output;

        }

        //search click function
        document.getElementById("search").addEventListener("click", function () {
            var displayResult = searchUser();
            // for (var i = 0; i < displayResult.length; i++) {
            //     console.log(displayResult[i]);
            //     document.getElementById("display").innerHTML = displayResult;
            // }

            var output = "";
            var fname = "Firstname: " + displayResult[0] + "<br>";
            output += fname;
            var lname = "Lastname: " + displayResult[1] + "<br>";
            output += lname;
            var uname = "Username: " + displayResult[2] + "<br>";
            output += uname;
            var email = "Email: " + displayResult[3] + "<br>";
            output += email;
            var password = "Password: " + displayResult[4] + "<br>";
            output += password;
            var cpassword = "Confirm Password: " + displayResult[5] + "<br>";
            output += cpassword;
            var age = "Age: " + displayResult[6] + "<br>";
            output += age;
            var bday = "Birthdate: " + displayResult[7] + "<br>";
            output += bday;
            var contact = "Contact: " + displayResult[8] + "<br>";
            output += contact;
            var dateTime = "Time and Date: " + displayResult[9] + "<br>";
            output += dateTime;
            document.getElementById("display").innerHTML = output;
            // var abc = null;
            // abc += "";
        });

        //print user input
        function registerUser() {

            //get current date and time
            var timeDate = new Date();

            // display
            // signup = "First name: " + FirstName.value + "<br>" + "Last Name: " + LastName.value + "<br>" + "Username: " + UserName.value + "<br>" + "Email: " + Email.value + "<br>" + "Password: " + Password.value + "<br>" + "Confirm Password: " + ConfirmPassword.value + "<br>" + "Birthdate: " + Birthdate.value + "<br>" + "Age: " + getAge() + "yrs old" + "<br>" + "Contact: " + Contact.value + "<br>" + "Time and Date: " + timeDate;

            // signup = searchUser();

            console.log("First name: " + FirstName.value);
            console.log("Last name: " + LastName.value);
            console.log("Username: " + UserName.value);
            console.log("Email: " + Email.value);
            console.log("Password: " + Password.value);
            console.log("Confirm Password: " + ConfirmPassword.value);
            console.log("Birthdate: " + Birthdate.value);
            console.log("Age: " + getAge() + "yrs old");
            console.log("Contact: " + Contact.value);
            console.log("Time and Date: " + timeDate);

            saveUser();

            // document.getElementById("display").innerHTML = searchUser();
        }
    </script>
</body>

</html>