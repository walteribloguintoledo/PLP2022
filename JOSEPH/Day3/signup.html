<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <title>Signup</title>
</head>

<body onload="document.form1.fname.focus()">
    <form name="form1">
        <h2>Register</h2>
        <hr>
        <div class="row mb-3">
            <label for="fname" class="col-sm-2 col-form-label">Firstname</label>
            <div class="col-sm-10">
                <input type="text" class="form-control" id="fname" placeholder="ex.(John)" name="fname">
            </div>
        </div>
        <div class="row mb-3">
            <label for="lname" class="col-sm-2 col-form-label">Lastname</label>
            <div class="col-sm-10">
                <input type="text" class="form-control" id="lname" placeholder="ex.(Wick)" name="lname">
            </div>
        </div>
        <div class="row mb-3">
            <label for="uname" class="col-sm-2 col-form-label">Username</label>
            <div class="col-sm-10">
                <input type="text" class="form-control" id="uname" placeholder="ex.(JWick)" name="uname">
            </div>
        </div>
        <div class="row mb-3">
            <label for="email" class="col-sm-2 col-form-label">Email</label>
            <div class="col-sm-10">
                <input type="text" class="form-control" id="email" placeholder="ex.(john_wick@gmail.com)" name="email">
            </div>
        </div>
        <div class="row mb-3">
            <label for="password" class="col-sm-2 col-form-label">Password</label>
            <div class="col-sm-10">
                <input type="password" class="form-control" id="password" placeholder="Enter your Password"
                    name="password">
            </div>
        </div>
        <div class="row mb-3">
            <label for="cpassword" class="col-sm-2 col-form-label">Confirm Password</label>
            <div class="col-sm-10">
                <input type="password" class="form-control" id="cpassword" placeholder="Enter your Confirm Password"
                    name="cpassword">
            </div>
        </div>
        <div class="row mb-3">
            <label for="birthdate" class="col-sm-2 col-form-label">Birthdate</label>
            <div class="col-sm-10">
                <input type="date" class="form-control" id="birthdate" name="birthdate">
            </div>
        </div>
        <div class="row mb-3">
            <label for="contact" class="col-sm-2 col-form-label">Contact</label>
            <div class="col-sm-10">
                <input type="tel" class="form-control" id="contact" placeholder="Enter your Contact" name="contact"
                    maxlength="11">
            </div>
        </div>
        <button id="print" type="button" class="btn btn-primary">Register</button>
        <button id="search" type="button" class="btn btn-primary">Search</button>
        <div class=" signup_link">
            Already have an account? <a href="login.html">Login</a>
        </div>

        <div id="display"></div>
    </form>


    <!-- --------------------------------------------------------javascript---------------------------------------------- -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>

        //current time and date
        var timeDate = new Date();

        //input ids
        var FirstName = $("#fname");
        var LastName = $("#lname");
        var UserName = $("#uname");
        var Email = $("#email");
        var Password = $("#password");
        var ConfirmPassword = $("#cpassword");
        var Birthdate = $("#birthdate");
        var Contact = $("#contact");

        var letters = /^[A-Za-z]+$/;//letters only

        var mailformat = /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/;//valid email

        var numbers = /^[0-9]+$/;//numbers only

        var mixed = /^[0-9a-zA-Z]+$/ //letters and numbers

        // var signup = null; //print users in div
        //validation
        $(document).ready(function () {
            $("#print").click(function (e) {
                e.preventDefault();
                if ($("#fname").val() == "") {
                    alert("Firstname is empty.");
                    $("#fname").focus();
                    return false;
                } else if (!$("#fname").val().match(letters)) {
                    alert("Firstname should be letters only.");
                    $("#fname").focus();
                    return FirstName.val('');
                }
                if ($("#lname").val() == "") {
                    alert("Lastname is empty.");
                    $("#lname").focus();
                    return false;
                } else if (!$("#lname").val().match(letters)) {
                    alert("Lastname should be letters only.");
                    $("lfname").focus();
                    return LastName.val('');
                } else if ($("#uname").val().length < 4 || $("#uname").val().length > 10) {
                    alert("Username must be 4 character to 10 characters long.");
                    $("#uname").focus();
                    return false;
                } else if (userNameTaken(UserName) !== false) {
                    $("#uname").focus();
                    return UserName.val('');
                }
                if ($("#email").val() == "") {
                    alert("Email is empty.");
                    $("#email").focus();
                    return false;
                } else if (!$("#email").val().match(mailformat)) {
                    alert("Email is invalid.");
                    $("#email").focus();
                    return Email.val('');
                }
                if ($("#password").val() == "") {
                    alert("Password is empty.");
                    $("#password").focus();
                    return Password.val('');
                } else if ($("#password").val().length < 6 || $("#cpassword").val().length > 12) {
                    alert("Password must be 6 character to 12 characters long.");
                    $("#password").focus();
                    return Password.val('');
                }
                if ($("#cpassword").val() == "") {
                    alert("Confirm Password is empty.");
                    $("#cpassword").focus();
                    return ConfirmPassword.val('');
                } else if ($("#password").val() != $("#cpassword").val()) {
                    alert("Password does not match.");
                    $("#cpassword").focus();
                    return ConfirmPassword.val('');
                }
                if ($("#birthdate").val() == "") {
                    alert("Birthdate is empty.");
                    $("#birthdate").focus();
                    return Birthdate.val('');
                }
                if ($("#contact").val() == "") {
                    alert("Contact is empty.");
                    $("#contact").focus();
                    return Contact.val('');
                } else if (!$("#contact").val().match(numbers)) {
                    alert("Contact is invalid.");
                    $("#contact").focus();
                    return Contact.val('');
                }
                else {
                    registerUser();
                }
            });
        });

        //empty input
        function isEmpty(text) {
            if (text === "") {
                return true;
            } else {
                return false;
            }
        }

        //age function
        function getAge() {
            //get age using date
            var bday = new Date(Birthdate.val());
            if (Birthdate.val() == null || Birthdate.val() == '') {
                return false;
            } else {

                //milliseconds since jan 1, 1970 up to current date minus milliseconds from jan 1, 1970 to date given
                var monthDifference = Date.now() - bday.getTime();

                //converts the calculated difference in date format 
                var newDate = new Date(monthDifference);

                //get year from date
                var getYear = newDate.getUTCFullYear();

                //now calculate the absoltue value of age
                var Age = Math.abs(getYear - 1970);

                return Age;
            }
        }

        //array of user input
        var userInput = JSON.parse(localStorage.getItem('userInput')) ?? new Array();
        console.log(userInput);

        //save user array
        function registerUser() {

            // display
            // signup = "First name: " + FirstName.value + "<br>" + "Last Name: " + LastName.value + "<br>" + "Username: " + UserName.value + "<br>" + "Email: " + Email.value + "<br>" + "Password: " + Password.value + "<br>" + "Confirm Password: " + ConfirmPassword.value + "<br>" + "Birthdate: " + Birthdate.value + "<br>" + "Age: " + getAge() + "yrs old" + "<br>" + "Contact: " + Contact.value + "<br>" + "Time and Date: " + timeDate;

            // signup = searchUser();

            console.log("First name: " + FirstName.val());
            console.log("Last name: " + LastName.val());
            console.log("Username: " + UserName.val());
            console.log("Email: " + Email.val());
            console.log("Password: " + Password.val());
            console.log("Confirm Password: " + ConfirmPassword.val());
            console.log("Birthdate: " + Birthdate.val());
            console.log("Age: " + getAge() + "yrs old");
            console.log("Contact: " + Contact.val());
            console.log("Time and Date: " + timeDate);

            // saveUser();

            var userData = {
                firstname: FirstName.val(),
                lastname: LastName.val(),
                username: UserName.val(),
                email: Email.val(),
                password: Password.val(),
                confirm: ConfirmPassword.val(),
                age: getAge() + "yrs old",
                birthdate: Birthdate.val(),
                contact: Contact.val(),
                timendate: timeDate
            };

            localStorage.setItem('userData', JSON.stringify(userData));
            userInput.push(userData);
            localStorage.setItem('userInput', JSON.stringify(userInput));
            userInput = JSON.parse(localStorage.getItem('userInput'));
            console.log(userInput);

            $("#fname").val('');
            $("#lname").val('');
            $("#uname").val('');
            $("#email").val('');
            $("#password").val('');
            $("#cpassword").val('');
            $("#birthdate").val('');
            $("#contact").val('');
            $("#display").innerHTML = "";

            alert("Successfully Registered!");
            // return userData;

            // document.getElementById("display").innerHTML = searchUser();
        }

        //username alredy exists
        function userNameTaken(inputData) {
            if (userInput === undefined) {
                return false;
            }

            var userInfo = null;

            userInput.forEach(user => {
                if (inputData.val() === user.username) {
                    userInfo = user;
                }
            });

            if (userInfo !== null) {
                alert('Please choose another username.');
            } else {
                return false;
            }
        }

        //search fucntion
        function searchUser() {
            var output = null;
            var findData = $("#uname").val();

            for (let i = 0; i < userInput.length; i++) {
                if (userInput[i][2] === findData) {
                    output = userInput[i];
                    // console.log(output);
                    // document.getElementById("display").innerHTML = output;
                    break;
                }
            }

            return output;

        }

        //search click function
        $(document).ready(function () {
            $("#search").click(function (e) {
                e.preventDefault();
                var displayResult = searchUser();
                // for (var i = 0; i < displayResult.length; i++) {
                //     console.log(displayResult[i]);
                //     document.getElementById("display").innerHTML = displayResult;
                // }

                var output = "";
                var fname = "Firstname: " + "<br>";
                output += fname;
                var lname = "Lastname: " + "<br>";
                output += lname;
                var uname = "Username: " + "<br>";
                output += uname;
                var email = "Email: " + "<br>";
                output += email;
                var password = "Password: " + "<br>";
                output += password;
                var cpassword = "Confirm Password: " + "<br>";
                output += cpassword;
                var age = "Age: " + "<br>";
                output += age;
                var bday = "Birthdate: " + "<br>";
                output += bday;
                var contact = "Contact: " + "<br>";
                output += contact;
                var dateTime = "Time and Date: " + "<br>";
                output += dateTime;
                $("#display").html(output);

                // console.log(output);
                // var abc = null;
                // abc += "";
            });
        });
    </script>
</body>

</html>