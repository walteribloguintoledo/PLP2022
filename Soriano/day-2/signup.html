<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up</title>
    <link rel="stylesheet" href="../day-1/styles/htmlpage.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="img">
    <section class="login-container d-flex align-items-center justify-content-center text-white" style="background-image:url(../day-1/images/login.jpg); background-repeat: no-repeat; background-size: cover;">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-md-6 text-center mb-5">
                    <h2 class="heading-section">Blog Site</h2>
                </div>
            </div>
            <div class="row justify-content-center">
                <div class="col-md-6 col-lg-4">
                    <div class="login-wrap p-0">
                        <h3 class="mb-4 text-center">Create an account</h3>
                        <form action="#" class="signin-form" id="sign_up_form">
                            <div class="form-group my-2">
                                <input type="text" id="full_name" class="form-control" placeholder="Fullname" required>
                            </div>
                            <div class="form-group my-2">
                                <input type="text" id="user_name" class="form-control" placeholder="Username" required>
                            </div>
                            <div class="form-group my-2">
                                <input type="email" id="email_address" class="form-control" placeholder="Email Address" required>
                            </div>
                            <div class="form-group my-2">
                                <input type="text" id="address" name="company" class="form-control" placeholder="Address" required>
                            </div>
                            <div class="form-group my-2">
                                <input type="date" id="birth_date" class="form-control" placeholder="Birthdate"
                                    required>
                            </div>
                            <div class="form-group my-2">
                                <input type="number" id="contact_number" class="form-control" placeholder="Contact No."
                                    required>
                            </div>
                            <div class="form-group my-2">
                                <input id="password-field" type="password" class="form-control" placeholder="Password"
                                    required>
                                <span toggle="#password-field"
                                    class="fa fa-fw fa-eye field-icon toggle-password"></span>
                            </div>
                            <div class="form-group my-2">
                                <input id="confirm-password-field" type="password" class="form-control"
                                    placeholder="Re-type Password" required>
                                <span toggle="#password-field"
                                    class="fa fa-fw fa-eye field-icon toggle-password"></span>
                            </div>
                            <div class="form-group my-2">
                                <button type="submit" class="form-control btn btn-primary submit px-3">Submit</button>
                            </div>
                            <div class="form-group d-md-flex my-2">
                                <div class="w-50">
                                    <label class="checkbox-wrap checkbox-primary">Remember Me
                                        <input type="checkbox" checked>
                                        <span class="checkmark"></span>
                                    </label>
                                </div>
                                <div class="w-50">
                                    <a href="#" class="w-100" style="color: #fff">
                                        <p class="text-end">Already have an account?</p>
                                    </a>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>

                <div id="container-div" class="container-div"></div>
            </div>
        </div>
    </section>

    <section style="height: 100vh;">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-md-6 col-lg-4">
                    <div class="login-wrap p-0">
                        <h3 class="my-4 text-center">Search User</h3>
                        <form action="#" class="search_user_form" id="search-user-form">
                            <div class="form-group my-2">
                                <input type="text" id="search-user-name" class="form-control" placeholder="Username" required>
                            </div>
                            <div class="form-group my-2">
                                <button type="submit" class="form-control btn btn-primary submit px-3">Search</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div id="user-container" class="container" style = "white-space: pre;"></div>
    </section>

    <script defer>
        function removeWhiteSpace(value) { return value.replace(/\s/g, ""); }

        function isCharactersOnly(elem) { return /^[a-zA-Z]+$/.test(removeWhiteSpace(elem.value)) ? true : false; }

        function isDigitsOnly(elem) { return /^[0-9]+$/.test(removeWhiteSpace(elem.value)) ? true : false; }

        function checkifEmpty(elem) {
            return removeWhiteSpace(elem.value) === "" ? alert(elem.id + " is required.") : false;
        }

        function checkIfString(elem) {
            return isCharactersOnly(elem) == false ? alert(elem.id + " must be string.") : false;
        }

        function checkIfNumeric(elem) {
            return isDigitsOnly(elem) == false ? alert(elem.id + " must be numeric. Remove spaces.") : false;
        }

        function checkContactNumber(elem) {
            const size = 11;
            if (checkIfNumeric(elem) !== false) return "error";

            return elem.value.length < size ? alert(elem.id + " must be " + size + " digits.") : false;
        }

        function checkPassword(elem, elemConfirm) {
            const size = 8;
            if (elem.value.length < 8) return alert(elem.id + " must be " + size + " characters.");

            if (elem.value !== elemConfirm.value) return alert("Password doesn't match");

            return false;
        }

        // function calculateAge(elem) {
        //     var today = new Date();
        //     var birthDate = new Date(elem.value);
        //     var age = today.getFullYear() - birthDate.getFullYear();
        //     var m = today.getMonth() - birthDate.getMonth();
        //     if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) age--;

        //     return age;
        // }

        function calculateAge(value) {
            var today = new Date();
            var birthDate = new Date(value);
            var age = today.getFullYear() - birthDate.getFullYear();
            var m = today.getMonth() - birthDate.getMonth();
            if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) age--;

            return age;
        }

        var listOfUsers = new Array();

        function userNameAlreadyExists(elem) {
            if (listOfUsers === undefined) return false;

            var retrievedUser = null;

            listOfUsers.forEach(user => {
                if (elem.value === user[1]) retrievedUser = user;
            });

            return retrievedUser !== null ? alert('username already taken!') : false;
        }

        var full_name = document.getElementById('full_name'),
            user_name = document.getElementById('user_name'),
            email_address = document.getElementById('email_address'),
            address = document.getElementById('address'),
            birth_date = document.getElementById('birth_date'),
            contact_number = document.getElementById('contact_number'),
            password = document.getElementById('password-field')
            password_confirm = document.getElementById('confirm-password-field');

        document.querySelector('#sign_up_form').addEventListener('submit', function (e) {
            e.preventDefault();

            // var value = "full name: " + full_name.value + "\u000ausername: " + user_name.value + "\u000aaddress: " + address.value + "\u000abirthdate: " + birth_date.value 
            //     + "\u000acontact number: " + contact_number.value + "\u000aAge: " + calculateAge(birth_date) + "\u000aSubmitted: " + new Date();
            // console.log(value);
            // var div_container = document.getElementById("container-div");
            // div_container.innerHTML = "";

            // var p = document.createElement("p");
            // var text = document.createTextNode(value);
            // p.appendChild(text);
            // p.style = "white-space: pre;";

            if (checkifEmpty(full_name) !== false) return;

            if (checkIfString(full_name) !== false) return;

            if (checkifEmpty(user_name) !== false) return;

            if (userNameAlreadyExists(user_name) !== false) return user_name.value = "";

            // if (userNameAlreadyExists(email_address) !== false) return email_address.value = "";

            if (checkifEmpty(address) !== false) return;

            if (checkifEmpty(birth_date) !== false) return;

            if (checkifEmpty(contact_number) !== false) return;
            if (checkContactNumber(contact_number) !== false) return;

            if (checkifEmpty(password) !== false) return;
            if (checkPassword(password, password_confirm) !== false) return;

            // alert("Your Age is: " + calculateAge(birth_date));

            // div_container.appendChild(p);

            var inputsArray = [
                full_name.value,
                user_name.value,
                address.value,
                birth_date.value,
                contact_number.value,
                new Date()
            ];

            listOfUsers.push(inputsArray);
            console.log(listOfUsers);

            full_name.value = "";
            user_name.value = "";
            email_address.value = "";
            address.value = "";
            birth_date.value = "";
            contact_number.value = "";
            password.value = "";
            password_confirm.value = "";

            alert("User saved!");
        });

        function findUser(value) {
            var user = null;

            for(let i = 0; i < listOfUsers.length; i++) {
                if (listOfUsers[i][1] === value) {
                    user = listOfUsers[i];
                    break;
                }
            }

            return user;
        }

        document.querySelector('#search-user-form').addEventListener('submit', function (e) {
            e.preventDefault();

            var userContainer = document.getElementById("user-container");
            var userName = document.getElementById('search-user-name').value;
            var retrievedUser = findUser(userName);

            userContainer.innerHTML = "";
            if (retrievedUser === null) return alert("User doesn't exists.");

            console.log("User found:", retrievedUser);

            var userInfo = "Result: \u000a(1) Full name: " + retrievedUser[0] + "\u000a(2) Username: " + retrievedUser[1] + "\u000a(3) Address: " + retrievedUser[2] + "\u000a(4) Birth Date: " + retrievedUser[3] + "\u000a(5) Contact Number: " + retrievedUser[4] + "\u000a(6) Age: " + calculateAge(retrievedUser[3]) + "\u000a(7) Submitted: " + retrievedUser[5];

            var p = document.createElement("p");
            var text = document.createTextNode(userInfo);
            p.appendChild(text);

            userContainer.appendChild(p);
        });
    </script>
</body>
</html>
